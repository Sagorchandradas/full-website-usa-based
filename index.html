<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>UsRewardCenter — Gift Card Rewards</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- NAVBAR -->
  <header class="header">
    <div class="container">
      <div class="brand">
        <img src="static/default-offer.jpg" alt="logo" style="width:44px;height:44px;border-radius:8px;object-fit:cover">
        <div>
          <h1>UsRewardCenter</h1>
          <div style="font-size:12px;color:rgba(255,255,255,0.85)">Verified US Gift Card Offers</div>
        </div>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/#offers">Offers</a>
        <a href="/#about">About</a>
        <a href="/#contact">Contact</a>
        <a href="/admin/" class="tag">New Blog</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-left">
      <h2>Claim popular gift cards — real US offers</h2>
      <p>Daily updated offers. Read steps, click claim, and follow the advertiser instructions. Posts are curated and tested for quality.</p>
      <div style="margin-top:16px">
        <button class="cta" id="viewLatest">View Latest Offers</button>
      </div>
    </div>
    <div style="width:320px">
      <img src="static/gift-hero.jpg" alt="gift" style="width:100%;border-radius:8px;box-shadow:0 10px 30px rgba(11,61,145,0.08)">
    </div>
  </section>

  <!-- OFFERS GRID -->
  <div class="section-title" id="offers"><h3 style="margin:0 16px">Latest Offers</h3></div>
  <div id="postsGrid" class="grid"></div>

  <!-- ABOUT -->
  <section id="about" style="max-width:1100px;margin:28px auto;padding:0 16px;">
    <div style="background:white;padding:18px;border-radius:12px;box-shadow:var(--card-shadow);">
      <h3>About UsRewardCenter</h3>
      <p style="color:var(--muted)">UsRewardCenter curates verified US-only offers (gift cards, rewards, and more). We provide clear steps and honest info — always mention GEO & device requirements in posts.</p>
    </div>
  </section>

  <div class="footer">© <span id="year"></span> UsRewardCenter — Built for safe & verified offers</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
/* CONFIG: if using GitHub-based posts, change these; for Netlify CMS the repo will be public and we can fetch raw content.
   For local demo you can use /content/posts/*.md (we provided sample files).
*/
const GITHUB_USER = "GITHUB_USER"; // replace when pushing to GitHub (optional)
const REPO = "REPO_NAME";
const BRANCH = "main";

document.getElementById('year').innerText = new Date().getFullYear();
document.getElementById('viewLatest').addEventListener('click', ()=> window.scrollTo({top:800,behavior:'smooth'}));

async function loadPosts(){
  // Preferred: repo hosted on GitHub public and posts under content/posts/ as .md files
  // This fallback loads local content when running in Netlify or local server where content exists
  try {
    // Try local content folder first (works locally & when Netlify deploy includes content)
    const indexRes = await fetch('/content/posts/posts.json');
    if(indexRes.ok){
      const files = await indexRes.json();
      await renderFromLocalList(files);
      return;
    }
  } catch(e){ /* ignore */ }

  // Otherwise try GitHub raw (requires you to set GITHUB_USER & REPO)
  if(GITHUB_USER && REPO){
    const api = `https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/content/posts?ref=${BRANCH}`;
    try{
      const res = await fetch(api);
      if(!res.ok) throw new Error('no github posts');
      const files = await res.json();
      const mdFiles = files.filter(f=>f.name.endsWith('.md')).map(f=>f.name);
      await renderFromLocalList(mdFiles, true);
      return;
    }catch(e){ console.warn('no posts found via GitHub',e); }
  }

  document.getElementById('postsGrid').innerHTML = '<div style="padding:18px;color:var(--muted)">No posts yet. Use the Admin → New Blog to publish.</div>';
}

async function renderFromLocalList(list, useGitRaw=false){
  const grid = document.getElementById('postsGrid');
  grid.innerHTML = '';
  for(const fname of list.reverse()){
    const url = useGitRaw ? `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/${BRANCH}/content/posts/${fname}` : `/content/posts/${fname}`;
    try{
      const text = await fetch(url).then(r=>r.text());
      const meta = parseFrontMatter(text);
      const excerpt = (meta.body||'').split('\n').slice(0,3).join(' ').substr(0,180);
      const slug = fname.replace('.md','');
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${meta.data.image || 'static/default-offer.jpg'}" alt="${meta.data.title}">
        <h3>${meta.data.title}</h3>
        <p>${excerpt}...</p>
        <div class="meta">
          <span class="small">${meta.data.date || ''}</span>
          <div>
            <button class="claim-btn" onclick="goToPost('${slug}')">Read & Claim</button>
            <button class="copy-link" onclick="copyLink('${slug}')">Copy Link</button>
          </div>
        </div>
      `;
      grid.appendChild(card);
    }catch(err){
      console.warn('failed to load', fname, err);
    }
  }
}

function parseFrontMatter(md){
  const fm = {data:{}, body:md};
  if(md.startsWith('---')){
    const end = md.indexOf('---',3);
    if(end !== -1){
      const yaml = md.substring(3,end).trim();
      fm.body = md.substring(end+3).trim();
      yaml.split('\n').forEach(line=>{
        const idx = line.indexOf(':');
        if(idx>0){
          const key = line.substring(0,idx).trim();
          let value = line.substring(idx+1).trim();
          value = value.replace(/^["']|["']$/g,'');
          fm.data[key] = value;
        }
      });
    }
  }
  return fm;
}

function goToPost(slug){ window.location.href = `post.html?post=${slug}`;}
function copyLink(slug){
  const postUrl = `${location.origin}/post.html?post=${slug}`;
  navigator.clipboard.writeText(postUrl).then(()=> alert('Post link copied: '+postUrl));
}

loadPosts();
</script>
</body>
</html>
